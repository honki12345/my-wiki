# JavaScript 표준을 위한 움직임: CommonJs와 AMD

- <https://d2.naver.com/helloworld/12864>

## 서버사이드 JavaScript의 주요쟁점

- 서로 호환되는 표준 라이브러리가 없다
- 데이터베이스에 연결할 수 있는 표준 인터페이스가 없다
- 다른 모듈을 삽입하는 표준적인 방법이 없다
- 코드를 패키징해서 배포하고 설치하는 방법이 필요하다
- 의존성 문제까지 해결하는 공통 패키지 모듈 저장소가 필요하다

## 핵심은 모듈화

- 위의 문제점들은 결국 모듈화로 귀결된다
- CommonJs의 주요명세는 이 모듈을 어떻게 정의하고, 어떻게 사용할 것인가에 대한 것이다
- 모듈화는 아래의 세 부분으로 이루어진다
  - 스코프(Scope): 모든 모듈은 자신만의 독립적인 실행 영역이 있어야한다
    - 전역변수와 지역변수를 분리하는 것이 매우 중요하다. 서버사이드 Javascript의 경우에는 파일마다 독립적인 파일 스코프가 있기 때문에 파일 하나에 모듈 하나를 작성하면 해결된다
  - 정의(Definition): 모듈 정의는 exports 객체를 이용한다
  - 사용(Usage): 모듈 사용은 require 함수를 이용한다
- CommonJs 모듈 명세는 모든 파일이 로컬 디스크에 있어 필요할 때 바로 불러올 수 있는 상황을 전제로 한다 (서버사이드 JavaScript 환경)
  - 브라우저에서는 필요한 모듈을 모두 내려받을때 까지 아무것도 할 수 없게 된다

## 비동기 모듈 로드 문제

- 브라우저 환경에서는 파일단위의 스코프가 없고, 표준 `<script>`로 로드하면 뒤의 파일의 변수가 앞의 파일의 변수를 덮어쓴다
- 서버모듈을 비동기적으로 클라이언트(브라우저)에 전송할 수 있는 모듈전송포맷(module transport format)을 추가로 정의했다
  - 이 명세에 따라 서버사이드에서 사용하는 모듈을 다음 예의 브라우저에서 사용하는 모듈과 같이 전송 포맷으로 감싸면 서버모듈을 비동기적으로 로드할 수 있게된다
- 브라우저에서 모듈 사용시 `require.define()`함수를 통해(함수 클로저) 전역변수를 통제한다

ㅈ---
